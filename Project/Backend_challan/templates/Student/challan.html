<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Boxicons -->
    <link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
    <!-- My CSS -->
    <title>Food Menu</title>
    <!--Google Font-->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <!--Stylesheet-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.6.1.min.js"
        integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script>

    <link rel="stylesheet" href="/static/Student/style.css">
    <link rel="stylesheet" href="/static/Student/invoice.css">

    <title>see challan</title>
</head>

<body>
    <!-- SIDEBAR -->
    <section id="sidebar">
        <a href="#" class="brand">
            <i class='bx bxs-smile'></i>
            <span class="text">Mess Student</span>
        </a>
        <ul class="side-menu top">
            <li>
                <a href="/">
                    <i class='bx bxs-dashboard'></i>
                    <span class="text">Home</span>
                </a>
            </li>
            <li>

                <a href="/menu">
                    <i class='bx bx-dish'></i>
                    <span class="text">Menu</span>
                </a>
            </li>
            <li>
                <a href="/analytics">
                    <i class='bx bxs-doughnut-chart'></i>
                    <span class="text">Analytics</span>
                </a>
            </li>
            <li class="active">
                <a href="/challan">
                    <i class='bx bxs-doughnut-chart'></i>
                    <span class="text">See challan</span>
                </a>
            </li>
            <!-- <li>
				<a href="#">
					<i class='bx bx-user-plus' ></i>
					<span class="text">Add Student</span>
				</a>
			</li> -->


        </ul>
        <ul class="side-menu">

            <li>
                <a href="/logout" class="logout">
                    <i class='bx bxs-log-out-circle'></i>
                    <span class="text">Logout</span>
                </a>
            </li>
        </ul>
    </section>
    <!-- SIDEBAR -->

    <section id="content">
		<!-- NAVBAR -->
		<nav>
			<i class='bx bx-menu'></i>
			<!-- <a href="#" class="nav-link">Categories</a> -->
			<form action="#">
				<div class="form-input">
					<input type="search" placeholder="Search...">
					<button type="submit" class="search-btn"><i class='bx bx-search'></i></button>
				</div>
			</form>
			<input type="checkbox" id="switch-mode" hidden>
			<label for="switch-mode" class="switch-mode"></label>
			<a href="#" class="notification">
				<i class='bx bxs-bell'></i>
				<span class="num">8</span>
			</a>
			<a href="/profile" class="profile">
				<img src="static/img/people.png">
			</a>
		</nav>
		<!-- NAVBAR -->
        <main>
            <ul class="box-info">

                <li>
                    <i class='bx bx-plus'></i>
                    <a href="/pay"><span class="text">
                            <h3>Pay Online</h3>

                        </span></a>
                </li>



                <li>
                    <i class='bx bxs-cloud-download'></i>
                    <a href="#" ><span onclick="printDiv('invoice','invoice')"class="text">
                            <h3>Download pdf</h3>
                            <h3 id="email" style="display: none;">{{email}}</h3>


                        </span></a>
                </li>



            </ul>
            <div class="invoice" id="invoice">
                <header>
                    <h1>Invoice</h1>
                    <address class="text">
                        <span>
                            <p id="name">Kami jhang</p>
                            <p id="phone">Deaprtment Pucit</p>
                            <p id="cnic">Room No. 40</p>
                            <p>HBL</p>
                        </span>
                        <img id="logo" alt="" src="/static/img/pu.png">
                    </address>
                </header>
                <article>
                    <h1>Recipient</h1>
                    <address class="text">
                        <p>Punjab University Old Campus<br>Account number: 01330012642803</p>
                    </address>
                    <table class="meta">
                        <tr>
                            <th><span class="text">Invoice #</span></th>
                            <td><span id="invoice-id" class="text">101138</span></td>
                        </tr>
                        <tr>
                            <th><span class="text">Date</span></th>
                            <td><span id="date" class="text">January 1, 2012</span></td>
                        </tr>
                        <tr>
                            <th><span class="text">Amount Due</span></th>
                            <td><span id="prefix" class="text">Rs.<span class="billAmount">600.00</span></span></td>
                        </tr>
                    </table>
                    <table class="inventory" style="margin: 40px 0px;">
                        <thead style="margin: 0px 10px;">
                            <tr >
                                <th><span class="text">No. </span></th>
                                <th><span class="text">Description</span></th>
                                <th><span class="text">Price</span></th>

                            </tr>
                        </thead>
                        <tbody style="margin: 0px 10px;">
                            <tr>
                                <td><span class="text">1</span></td>
                                <td><a class="cut">-</a><span class="text">Dues for this month</span></td>
                                <td><span data-prefix class="text">Rs.<span class="billAmount"
                                            class="text">600.00</span></span></td>
                            </tr>
                        </tbody>
                    </table>

                    <table class="balance">
                        <tr>
                            <th><span class="text">Total</span></th>
                            <td><span data-prefix class="text">Rs.<span class="billAmount">600.00</span></span></td>
                        </tr>

                    </table>
                </article>
                <aside>
                    <span class="text">
                        <h1>Additional Notes</h1>
                    </span>
                    <div>
                        <span class="text">
                            <p>A finance charge of 1.5% will be made on unpaid balances after 30 days.</p>
                        </span>
                    </div>
                </aside>
            </div>
        </main>

    </section>
    <!-- CONTENT -->

    <script>
        //js for downloading
        // var doc = new jsPDF();
        // function saveDiv(divId, title) {
        //     // console.log(document.getElementById(divId).innerHTML )
        //     doc.fromHTML(`<html><head><title>${title}</title></head><body>` + document.getElementById(divId).innerHTML + `</body></html>`);
        //     console.log(doc)
        //     doc.save('div.pdf');
        // }
       
        //
        $(document).ready(function () {
            var currentuser = document.getElementById("email").innerText
            const formatedDate = new Date().toLocaleDateString();
            console.log(currentuser)
            $.ajax({
                url: `/api/updateBill/${currentuser}`, // url where to submit the request
                type: "GET",
                dataType: 'json',
                contentType: "application/json; charset=utf-8",

                success: function (result) {
                    let vary = document.getElementsByClassName("billAmount");
                    // console.log(vary)
                    $(".billAmount").each(function (i, obj) {
                        obj.innerText = "     " + result["billAmount"] + '/-'

                    })
                    $.ajax({
                        url: `/api/User/${currentuser}`, // url where to submit the request
                        type: "GET",
                        dataType: 'json',
                        contentType: "application/json; charset=utf-8",

                        success: function (result) {

                            console.log(result["_id"]["$oid"])
                            document.getElementById("name").innerText = "Name :\t" + String(result["fullName"]);
                            document.getElementById("phone").innerText = "Phone :\t" + String(result["phone"]);
                            document.getElementById("cnic").innerText = "CNIC : \t" + String(result["cnic"]);
                            document.getElementById("invoice-id").innerText = String(result["_id"]["$oid"]);
                            document.getElementById("date").innerText = formatedDate;

                            // you can see the result from the console
                            // tab of the developer tools
                        },
                        error: function (xhr, resp, text) {
                            console.log("here")
                            // console.log("error")
                            console.log(xhr, resp, text);

                        }
                    });
                    // console.log(result)
                    // document.getElementById("billAmount").innerText = String(result["billAmount"]) + "/-";
                    // document.getElementById("numberOfAttendences").innerText = String(result["numberOfAttendences"]) + "/-";
                    // you can see the result from the console
                    // tab of the developer tools
                },
                error: function (xhr, resp, text) {
                    // console.log("error")
                    console.log(xhr, resp, text);

                }
            });
        });
    </script>
    <script src="static/Student/script.js"></script>

</body>

</html>